<!DOCTYPE html>
<html>
<head>
    <title>Bookmarklet Installer</title>
</head>
<body>
    <li>
        10-2022 Drag and drop the following bookmarklet to your ‘Bookmarks’ Toolbar in Chrome (you can also do this with most modern browsers).
    </li>
    <div class="center">
        <a class="myButton" id="bookmark" title="Bookmarklet" href="javascript:(function() {

    const isValidLink = (link) => {
        const unwantedPatterns = [
            /google\./, /\~:text/, /cache/, /blogger\.com/, /\.yahoo\./, /youtube\.com\/\?gl=/, 
            /youtube\.com\/results/, /javascript:/, /api\.technorati\.com/, /botw\.org\/search/, 
            /del\.icio\.us\/url\/check/, /digg\.com\/search/, /search\.twitter\.com\/search/, 
            /search\.yahoo\.com\/search/, /siteanalytics\.compete\.com/, /tools\.seobook\.com\/general\/keyword\/suggestions/, 
            /web\.archive\.org\/web\//, /whois\.domaintools\.com/, /www\.alexa\.com\/data\/details\/main/, 
            /www\.bloglines\.com\/search/, /www\.majesticseo\.com\/search\.php/, /www\.semrush\.com\/info\//, 
            /www\.semrush\.com\/search\.php/, /www\.stumbleupon\.com\/url/, /wikipedia\.org\/wiki\/Special:Search/
        ];
        return !unwantedPatterns.some(pattern => pattern.test(link));
    };

    const unwantedIds = ['hdtb_more', 'hdtb_tls', 'uh_hl'];

    const generateSERPData = () => {
        let output = '<html><head><title>SEO SERP Extraction Tool</title></head><body>';
        output += '<table><tbody><tr><td><h1>TNT SEO SERP Extraction Tool</h1></td></tr></tbody></table>';

		
		const pageAnchors = document.getElementsByTagName('a'); /* This is to set up the counting loop and stopped functioning */
        const getTitle = document.getElementsByClassName('LC20lb MBeuO DKV0Md');
        const pageDesc = document.getElementsByClassName('VwiC3b yXK7lf lyLwlc yDYNvb W8l4ac lEBKkf');

        let indexCount = 0;
        let linkcount = 0;
        let linkLocation = '';
        let linkAnchorText = '';
        let pageOutput = '';
        alert('pageAnchors')

        output += '<table><th>ID</th><th>Link</th><th>Title</th><th>Description</th>';

        for (let i = 0; i < pageAnchors.length; i++) {
        	/ * probably close? const classStr = document.querySelector('div[jsname='UWckNb']'); */
        	 classStr = pageAnchors[i].parentNode.parentNode.getAttribute('class');
           	//alert(i +' '+classStr);
            if (classStr === 'kb0PBd cvP2Ce jGGQ5e') {
                const anchorID = pageAnchors[i].id;
                const anchorLink = pageAnchors[i].href;
                const anchorText = getTitle[indexCount]?.textContent || pageAnchors[i].innerText;
                const describePage = pageDesc[indexCount]?.textContent;

                if (anchorLink && isValidLink(anchorLink) && !unwantedIds.includes(anchorID)) {
                    linkLocation += anchorLink + '<br />';
                    linkAnchorText += anchorText + '<br />';
                    pageOutput += describePage + '<br />';
                    linkcount++;

                    output += `<tr><td>${linkcount}</td><td>${anchorLink}%C2%A0</td><td> ${anchorText}</td><td>${describePage}</td></tr>`;
                    if (indexCount < pageDesc.length - 1) indexCount++;
                }
            }
        }

        output += '</table><br/><h2>URL List</h2><div>' + linkLocation + '</div><br/><h2>Title</h2><div>' + linkAnchorText + '</div><br/><h2>Description</h2><div>' + pageOutput + '<br/>%C2%A0<br/>';
        with (window.open()) {
            document.write(output);
            document.close();
        }
    };

    generateSERPData();

})();">Google SERPs Extractor 10-17-2023</a>
    </div>
</body>
</html>
